---
title: "Starkex"
sidebarTitle: "Starkex"
---

# What

If you are building on [StarkEx]() or you need some sort of verification mechanism, this is probably
the right endpoint for you.

# How

Open a websocket connection on the environment of your choice.

```bash
wscat -c wss://ws.devnet.pragma.build/node/v1/data/subscribe
```

Sending a request to this endpoint establishes a channel to receive real-time data updates every 500 milliseconds.

## Subscribing

By default, no asset pairs are subscribed. To subscribe to specific pairs, send a message formatted as follows:

```json
{
  "msg_type": "subscribe",
  "pairs": ["BTC/USD", "ETH/USD:MARK"]
}
```

The server will confirm your subscription with a response like this:

```json
{
  "msg_type": "subscribe",
  // the pairs you are currently subscribed to, here we were already
  // subscribed to SOL/USD
  "pairs": ["BTC/USD", "ETH/USD:MARK", "SOL/USD"]
}
```

We currently support two types of subscriptions:

<Tabs>
  <Tab title="Index Price">
    #### Index price

    Median price for spot markets across supported exchanges.

    <Note>
      By default, subscriptions are for index prices.

      It means subscribing to a pair without specifying the type will subscribe to the index price. For example, to subscribe to the index price of BTC/USD, use `BTC/USD`.
    </Note>
  </Tab>
  <Tab title="Mark Price">
    #### Mark Price

    The mark price is the median perp price across supported exchanges.

    **For assets quoted in a stablecoin, we compute as follow**:

    1. Determine the median perp price of the asset quoted in the stablecoin.
    2. Determine the median spot price of the stablecoin in USD.
    3. Divide the median perp price by the median spot price of the stablecoin in USD.

    **For assets quoted in USD**:

    Determine the median perp price of the asset quoted in USD.

    <Note>
      To subscribe to a specific mark price, append `:MARK` to the pair name. For example, to subscribe to the perpetual index price of ETH/USD, use `ETH/USD:MARK`.
    </Note>
  </Tab>
</Tabs>

## Unsubscribing

To unsubscribe from specific pairs, send a message formatted as follows:

```json
{
  "msg_type": "unsubscribe",
  "pairs": ["BTC/USD"]
}
```

The server will confirm your unsubscription with a response like this:

```json
{
  "msg_type": "unsubscribe",
  // the pairs you are currently subscribed to
  "pairs": ["ETH/USD:MARK"]
}
```

## Response Format

Subscribed data will be provided in the following JSON format for each asset pair:

```json
{
  "global_asset_id": "0x12345",
  "median_price": "10000000000000001",
  "signature": "0x154786876ae878",
  "signed_prices": [
    {
      "oracle_asset_id": "0x12345000000000ABCDEF",
      "oracle_price": "1000000000000000000",
      "signing_key": "0x1234567890ABCDEF",
      "timestamp": "1234567",
      "signature": "0x1234567890ABCDEF"
    },
    {
      "oracle_asset_id": "0x12345000000000FEDCBA",
      "oracle_price": "1000000000000000002",
      "signing_key": "0xFEDCBA0987654321",
      "timestamp": "1234567",
      "signature": "0x1234567890ABCDEF"
    }
  ]
}
```

**Field Descriptions**:

- `global_asset_id`: Unique identifier for the asset encoded using the pair name.
- `median_price`: The median price of the asset.
- `signature`: Signature of the median price by the Pragma oracle.
- `signed_prices`: Array of the prices used to compute the median price:
  - `oracle_asset_id`: Unique identifier encoded using the pair and the publisher names.
  - `oracle_price`: Price provided by the oracle.
  - `signing_key`: Key used by the oracle to sign the price.
  - `timestamp`: Time when the price was recorded.
  - `signature`: Signature of the price by our publisher.

## Example

### Rust

We have already cooked a nice ratatui for you to test the endpoint, you can find it [here](https://github.com/astraly-labs/pragma-node/blob/dev/pragma-node/examples/starkex.rs).

Simply clone the `pragma-node` repository and run

```bash
cargo run --example starkex
```

### Python

You can use the following Python code to connect to the Pragma websocket endpoint and subscribe to the `TIA/USD` index price:

```python main.py [expandable]
import asyncio
import websockets
import json
from websockets.exceptions import ConnectionClosedError

PRAGMA_API_BASE_URL = "ws.devnet.pragma.build"
URI = f"node/v1/data/subscribe"
WS_URL = f"ws://{PRAGMA_API_BASE_URL}/${URI}"

SUBSCRIBE_MESSAGE = {"msg_type": "subscribe", "pairs": ["TIA/USD"]}


async def connect_to_websocket(uri):
    """Establish a connection to the websocket server."""
    try:
        websocket = await websockets.connect(uri)
        return websocket
    except Exception as e:
        print(f"Failed to connect to websocket: {e}")
        return None

async def subscribe_to_data(websocket, subscribe_message):
    """Send subscription message to the websocket."""
    try:
        await websocket.send(json.dumps(subscribe_message))
        print("Subscription message sent")
    except Exception as e:
        print(f"Failed to send subscription message: {e}")

async def handle_messages(websocket):
    """Handle incoming messages from the websocket."""
    try:
        async for message in websocket:
            print(f"Received message: {message}")
    except ConnectionClosedError:
        print("Connection closed")
    except Exception as e:
        print(f"Error receiving message: {e}")

async def consume_data(uri, subscribe_message):
    """Main function to consume data from websocket."""
    websocket = await connect_to_websocket(uri)
    if websocket:
        await subscribe_to_data(websocket, subscribe_message)
        await handle_messages(websocket)
        await websocket.close()

if __name__ == "__main__":
    try:
        asyncio.run(consume_data(URI, SUBSCRIBE_MESSAGE))
    except KeyboardInterrupt:
        print("Program interrupted")
    except Exception as e:
        print(f"An error occurred: {e}")
```

<Info>
  Replace `PRAGMA_API_BASE_URL` with the base URL of the Pragma API.
</Info>